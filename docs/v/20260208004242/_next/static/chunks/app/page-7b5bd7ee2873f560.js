(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{639:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>M});var a=n(5155),r=n(4520),i=n(9941),s=n(3195),l=n(4935),u=n(4045),o=n(2139),d=n(2115),c=n(556),p=n(7417),m=n(6369),y=n(161),f=n(4710),h=n(8245);let b=[{type:"constructor",inputs:[{name:"_feeReceiver",type:"address"}],stateMutability:"nonpayable"},{type:"function",name:"ACTION_COOLDOWN",inputs:[],outputs:[{name:"",type:"uint256"}],stateMutability:"view"},{type:"function",name:"FEE_BPS",inputs:[],outputs:[{name:"",type:"uint256"}],stateMutability:"view"},{type:"function",name:"MAX_ATTEMPTS",inputs:[],outputs:[{name:"",type:"uint8"}],stateMutability:"view"},{type:"function",name:"MAX_OBSTACLES_PER_SECOND",inputs:[],outputs:[{name:"",type:"uint8"}],stateMutability:"view"},{type:"function",name:"MAX_SCORE_PER_OBSTACLE",inputs:[],outputs:[{name:"",type:"uint32"}],stateMutability:"view"},{type:"function",name:"isOperator",inputs:[{name:"",type:"address"},{name:"",type:"address"}],outputs:[{name:"",type:"bool"}],stateMutability:"view"},{type:"function",name:"setOperator",inputs:[{name:"operator",type:"address"},{name:"allowed",type:"bool"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"obstaclePassed",inputs:[{name:"roundId",type:"uint256"},{name:"entryIndex_",type:"uint32"},{name:"obstacleCount_",type:"uint32"},{name:"deltaScore",type:"uint32"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"obstaclePassedFor",inputs:[{name:"roundId",type:"uint256"},{name:"player",type:"address"},{name:"entryIndex_",type:"uint32"},{name:"obstacleCount_",type:"uint32"},{name:"deltaScore",type:"uint32"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"attemptsUsed",inputs:[{name:"roundId",type:"uint256"},{name:"player",type:"address"}],outputs:[{name:"",type:"uint8"}],stateMutability:"view"},{type:"function",name:"currentAttemptScore",inputs:[{name:"roundId",type:"uint256"},{name:"player",type:"address"}],outputs:[{name:"",type:"uint256"}],stateMutability:"view"},{type:"function",name:"totalScore",inputs:[{name:"roundId",type:"uint256"},{name:"player",type:"address"}],outputs:[{name:"",type:"uint256"}],stateMutability:"view"},{type:"function",name:"entryIndex",inputs:[{name:"roundId",type:"uint256"},{name:"player",type:"address"}],outputs:[{name:"",type:"uint32"}],stateMutability:"view"},{type:"function",name:"startEntry",inputs:[{name:"roundId",type:"uint256"}],outputs:[],stateMutability:"payable"},{type:"function",name:"startAttempt",inputs:[{name:"roundId",type:"uint256"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"endAttempt",inputs:[{name:"roundId",type:"uint256"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"createRound",inputs:[{name:"entryFee",type:"uint256"},{name:"duration",type:"uint256"}],outputs:[{name:"roundId",type:"uint256"}],stateMutability:"nonpayable"},{type:"function",name:"finalizeRound",inputs:[{name:"roundId",type:"uint256"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"getPlayers",inputs:[{name:"roundId",type:"uint256"}],outputs:[{name:"",type:"address[]"}],stateMutability:"view"},{type:"function",name:"getScore",inputs:[{name:"roundId",type:"uint256"},{name:"player",type:"address"}],outputs:[{name:"",type:"uint256"}],stateMutability:"view"},{type:"function",name:"joinRound",inputs:[{name:"roundId",type:"uint256"}],outputs:[],stateMutability:"payable"},{type:"function",name:"joined",inputs:[{name:"",type:"uint256"},{name:"",type:"address"}],outputs:[{name:"",type:"bool"}],stateMutability:"view"},{type:"function",name:"nextRoundId",inputs:[],outputs:[{name:"",type:"uint256"}],stateMutability:"view"},{type:"function",name:"rounds",inputs:[{name:"",type:"uint256"}],outputs:[{name:"creator",type:"address"},{name:"entryFee",type:"uint256"},{name:"startTime",type:"uint256"},{name:"endTime",type:"uint256"},{name:"pool",type:"uint256"},{name:"finalized",type:"bool"},{name:"playerCount",type:"uint256"}],stateMutability:"view"},{type:"function",name:"submitAction",inputs:[{name:"roundId",type:"uint256"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"submitActions",inputs:[{name:"roundId",type:"uint256"},{name:"amount",type:"uint256"}],outputs:[],stateMutability:"nonpayable"},{type:"event",name:"EntryStarted",inputs:[{name:"roundId",type:"uint256",indexed:!0},{name:"player",type:"address",indexed:!0},{name:"entryIndex",type:"uint32",indexed:!1}]},{type:"event",name:"AttemptStarted",inputs:[{name:"roundId",type:"uint256",indexed:!0},{name:"player",type:"address",indexed:!0},{name:"entryIndex",type:"uint32",indexed:!1},{name:"attemptNumber",type:"uint8",indexed:!1}]},{type:"event",name:"AttemptEnded",inputs:[{name:"roundId",type:"uint256",indexed:!0},{name:"player",type:"address",indexed:!0},{name:"entryIndex",type:"uint32",indexed:!1},{name:"attemptsUsed",type:"uint8",indexed:!1},{name:"attemptScore",type:"uint256",indexed:!1},{name:"entryTotalScore",type:"uint256",indexed:!1},{name:"bestScore",type:"uint256",indexed:!1}]},{type:"event",name:"OperatorSet",inputs:[{name:"player",type:"address",indexed:!0},{name:"operator",type:"address",indexed:!0},{name:"allowed",type:"bool",indexed:!1}]},{type:"event",name:"ObstaclePassed",inputs:[{name:"roundId",type:"uint256",indexed:!0},{name:"player",type:"address",indexed:!0},{name:"entryIndex",type:"uint32",indexed:!0},{name:"obstacleCount",type:"uint32",indexed:!1},{name:"deltaScore",type:"uint32",indexed:!1},{name:"attemptScore",type:"uint256",indexed:!1},{name:"bestScore",type:"uint256",indexed:!1}]},{type:"event",name:"ActionsSubmitted",inputs:[{name:"roundId",type:"uint256",indexed:!0},{name:"player",type:"address",indexed:!0},{name:"amount",type:"uint256",indexed:!1},{name:"newScore",type:"uint256",indexed:!1}]},{type:"event",name:"ActionSubmitted",inputs:[{name:"roundId",type:"uint256",indexed:!0},{name:"player",type:"address",indexed:!0},{name:"newScore",type:"uint256",indexed:!1}]},{type:"event",name:"RoundCreated",inputs:[{name:"roundId",type:"uint256",indexed:!0},{name:"creator",type:"address",indexed:!0},{name:"entryFee",type:"uint256",indexed:!1},{name:"startTime",type:"uint256",indexed:!1},{name:"endTime",type:"uint256",indexed:!1}]},{type:"event",name:"RoundFinalized",inputs:[{name:"roundId",type:"uint256",indexed:!0},{name:"winner",type:"address",indexed:!0},{name:"payout",type:"uint256",indexed:!1},{name:"fee",type:"uint256",indexed:!1}]},{type:"event",name:"RoundJoined",inputs:[{name:"roundId",type:"uint256",indexed:!0},{name:"player",type:"address",indexed:!0}]}],x="0x8Cf51b3e1137C88961edBcb24F374c241C0EC472";function g(e){let{active:t,onDistance:n,onCrash:r,entrySeedBase:i,attemptNumber:s,onCombo:l,onFeedback:u}=e,o=(0,d.useRef)(n),c=(0,d.useRef)(r),p=(0,d.useRef)(l),m=(0,d.useRef)(u);(0,d.useEffect)(()=>{o.current=n},[n]),(0,d.useEffect)(()=>{c.current=r},[r]),(0,d.useEffect)(()=>{p.current=l},[l]),(0,d.useEffect)(()=>{m.current=u},[u]);let y=(0,d.useRef)(null),f=(0,d.useRef)(null),[h,b]=(0,d.useState)("ready"),x=(0,d.useRef)("ready"),[g,v]=(0,d.useState)(0),w=(0,d.useRef)(0),[S,M]=(0,d.useState)(!1),N=(0,d.useRef)(!1);(0,d.useEffect)(()=>{N.current=S},[S]);let j=(0,d.useRef)({y:0,vy:0,slidingUntil:0,dashingUntil:0}),C=(0,d.useRef)([]),R=(0,d.useRef)(0),E=(0,d.useRef)(0),I=(0,d.useRef)(0),T=(0,d.useRef)(0),k=(0,d.useRef)(!1),P=(0,d.useRef)(0x12345678),A=(e,t,n)=>e+(t-e)*n,_=e=>{let t=Math.max(0,Math.min(1,e));return t*t*(3-2*t)},D=e=>e<=8?.3*_(e/8):e<=24?A(.3,.65,_((e-8)/16)):e<=70?A(.65,1,_((e-24)/46)):1,B=()=>{let e=0|P.current;return e^=e<<13,e^=e>>>17,P.current=0|(e^=e<<5),(e>>>0)/0x100000000},F=(0,d.useMemo)(()=>({gravity:2400,jumpVy:-820,difficulty:{speed:{start:280,end:520,maxDashBonus:80},spawnGapPx:{start:520,end:190,min:175,jitterFrac:.18},hitboxPadPx:{start:8,end:2},highObstacleHeight:{start:40,end:52},highObstacleChance:{start:.18,end:.48}},obstacleW:34,runnerX:82,runnerW:22,runnerH:34,runnerSlideH:18,groundPad:24,slideMs:420,dashMs:220,holdToSlideMs:180,coyoteMs:90,jumpBufferMs:110,startGraceDistancePx:520}),[]);function L(){var e;j.current={y:0,vy:0,slidingUntil:0,dashingUntil:0},C.current=[],R.current=0,w.current=0,v(0),k.current=!1,E.current=0,null==(e=p.current)||e.call(p,0),P.current=(e=>{let t=0x811c9dc5;for(let n=0;n<e.length;n++)t^=e.charCodeAt(n),t=Math.imul(t,0x1000193);return 0|t})("".concat(null!=i?i:"local","|").concat(null!=s?s:1)),I.current=performance.now(),T.current=0,x.current="ready",b("ready")}function O(){t&&"ready"===x.current&&(x.current="running",b("running"))}(0,d.useEffect)(()=>{if(!t)return void L();L(),x.current="running",b("running")},[t,i,s]);let H=(e,t)=>!(T.current<=e)&&(.01>Math.abs(j.current.y-t)||e-I.current<=F.coyoteMs)&&(j.current.vy=F.jumpVy,T.current=0,!0),U=(0,d.useRef)({}),[W,z]=(0,d.useState)(0);(0,d.useEffect)(()=>{let e=(e,t)=>{if(U.current[e])return;let n=new Image;n.decoding="async",n.loading="eager",n.src=t,n.onload=()=>z(e=>e+1),U.current[e]=n},t=e=>new URL(e,window.location.href).toString();e("fluffle_run1",t("./sprites/fluffle_run1.svg")),e("fluffle_run2",t("./sprites/fluffle_run2.svg")),e("fluffle_slide",t("./sprites/fluffle_slide.svg")),e("ob_shard",t("./sprites/obstacle_shard.svg")),e("ob_drone",t("./sprites/obstacle_drone.svg")),e("ob_pylon",t("./sprites/obstacle_pylon.svg")),e("ob_tree",t("./sprites/obstacle_tree.svg"))},[]),(0,d.useEffect)(()=>{if(!t){f.current&&cancelAnimationFrame(f.current),f.current=null,x.current="ready",b("ready");return}let e=y.current;if(!e)return;let n=e.getContext("2d");if(!n)return;let a=performance.now(),r=F.startGraceDistancePx,i=performance.now(),s=()=>{let t=Math.max(1,Math.floor(window.devicePixelRatio||1)),{width:a,height:r}=e.getBoundingClientRect();e.width=Math.floor(a*t),e.height=Math.floor(r*t),n.setTransform(t,0,0,t,0,0);let i=r-F.groundPad;0===j.current.y&&(j.current.y=i)};s(),window.addEventListener("resize",s);let l=e=>{"d"===e.key.toLowerCase()&&M(e=>!e)};window.addEventListener("keydown",l);let u=t=>{let s=Math.min(.033,(t-a)/1e3);if(a=t,"running"===x.current){var l,d,y,h,g;let n=D(R.current),a=performance.now(),u=a<j.current.dashingUntil,f=A(F.difficulty.speed.start,F.difficulty.speed.end,n)+(u?F.difficulty.speed.maxDashBonus:0),S=e.clientWidth,M=e.clientHeight-F.groundPad;if(j.current.vy+=F.gravity*s,j.current.y+=j.current.vy*s,j.current.y>M?(j.current.y=M,j.current.vy=0,I.current=a):.01>Math.abs(j.current.y-M)&&(I.current=a),H(a,M),w.current>=r){let e=A(F.difficulty.highObstacleChance.start,F.difficulty.highObstacleChance.end,n),t=B()<1-e?"low":"high",a=Math.round(A(F.difficulty.highObstacleHeight.start,F.difficulty.highObstacleHeight.end,n)),i="low"===t?["ob_shard","ob_pylon","ob_tree"]:["ob_drone"],s=i[Math.floor(B()*i.length)]||("low"===t?"ob_shard":"ob_drone");C.current.push({x:S+40,w:F.obstacleW,h:"low"===t?26:a,kind:t,skin:s});let l=A(F.difficulty.spawnGapPx.start,F.difficulty.spawnGapPx.end,n),u=(2*B()-1)*F.difficulty.spawnGapPx.jitterFrac,o=Math.max(F.difficulty.spawnGapPx.min,l*(1+u));r=w.current+o}for(let e of C.current)e.x-=f*s;for(let e of(a<j.current.slidingUntil?F.runnerSlideH:F.runnerH,j.current.y,C.current))if(!e.passed&&e.x+e.w<F.runnerX&&(e.passed=!0,R.current+=1,E.current+=1,null==(l=p.current)||l.call(p,E.current),"low"===e.kind)){let t=M-e.h-j.current.y;t>=0&&t<=3?null==(d=m.current)||d.call(m,"perfect"):t>=0&&t<=8&&(null==(y=m.current)||y.call(m,"near"))}C.current=C.current.filter(e=>e.x>-e.w-20);let N=f*s;w.current+=N,o.current(N/10),t-i>250&&(i=t,v(w.current)),(()=>{let t=e.clientWidth,n=e.clientHeight;if(!t||!n)return!1;let a=n-F.groundPad,r=performance.now(),i=r<j.current.slidingUntil,s=r<j.current.dashingUntil,l=F.runnerX,u=F.runnerW,o=i?F.runnerSlideH:F.runnerH,d=j.current.y-o,c=D(R.current),p=Math.round(A(F.difficulty.hitboxPadPx.start,F.difficulty.hitboxPadPx.end,c)+3*!!s);for(let e of C.current){let t=e.x,n=a-e.h,r=e.w,i=e.h;if(l+p<t+r&&l+u-p>t&&d+p<n+i&&d+o-p>n)return!0}return!1})()&&(x.current="crashed",b("crashed"),E.current=0,null==(h=p.current)||h.call(p,0),k.current||(k.current=!0,null==(g=c.current)||g.call(c)))}(()=>{let t=e.clientWidth,a=e.clientHeight,r=a-F.groundPad,i=D(R.current),s="rgba(".concat(Math.round(7+10*i),",").concat(Math.round(10+8*i),",").concat(Math.round(22+28*i),",1)"),l=n.createLinearGradient(0,0,0,a);l.addColorStop(0,s),l.addColorStop(1,"rgba(7,10,18,1)"),n.fillStyle=l,n.fillRect(0,0,t,a);let u=Math.round(.18*a),o=Math.round(.34*a),d=.06*w.current%44;for(let e=-2;e<Math.ceil(t/44)+2;e++){let t=Math.floor(.06*w.current/44)+e,a=Math.round(40+Math.abs(Math.sin(999.13*t))%1*o),r=44*e-d,i=u+(o-a);n.fillStyle="rgba(11,18,32,0.85)",n.fillRect(r,i,38,a);let s=.18+.12*Math.sin(.002*w.current+t);n.fillStyle="rgba(34,211,238,".concat(Math.max(0,s),")"),n.fillRect(r+10,i+14,6,2),n.fillStyle="rgba(255,43,214,".concat(Math.max(0,.7*s),")"),n.fillRect(r+22,i+22,8,2)}n.fillStyle="rgba(255,255,255,0.03)";for(let e=0;e<a;e+=4)n.fillRect(0,e,t,1);n.strokeStyle="rgba(34,211,238,0.18)",n.lineWidth=1;for(let e=0;e<t;e+=28)n.beginPath(),n.moveTo(e-.6*w.current%28,r),n.lineTo(e-.6*w.current%28,a),n.stroke();let c=n.createLinearGradient(0,r,0,a);for(let e of(c.addColorStop(0,"rgba(34,211,238,0.18)"),c.addColorStop(1,"rgba(0,0,0,0.0)"),n.fillStyle=c,n.fillRect(0,r,t,a-r),C.current)){let t=r-e.h,a=U.current[e.skin];if((null==a?void 0:a.complete)&&a.naturalWidth>0){if(n.save(),"low"===e.kind)n.drawImage(a,e.x-10,t-18,e.w+20,e.h+30);else{let r=Math.max(24,Math.round(.6*e.h));n.drawImage(a,e.x-22,t-r,e.w+44,e.h+r+30)}n.restore();continue}if(n.save(),n.lineWidth=2,n.strokeStyle="rgba(0,0,0,0.75)","low"===e.kind){let a=e.w/4;n.beginPath(),n.moveTo(e.x,r);for(let i=0;i<4;i++){let s=e.x+i*a;n.lineTo(s+a/2,t),n.lineTo(s+a,r)}n.closePath(),n.fillStyle="#fbbf24",n.fill(),n.stroke()}else n.fillStyle="#22d3ee",n.fillRect(e.x,t,e.w,e.h),n.strokeRect(e.x,t,e.w,e.h);n.restore()}let p=performance.now()<j.current.slidingUntil,m=j.current.y<r-1,y=F.runnerW,f=p?F.runnerSlideH:F.runnerH,h=F.runnerX,b=j.current.y-f,g=Math.floor(w.current/80%2),v=U.current[p?"fluffle_slide":0===g?"fluffle_run1":"fluffle_run2"];if((null==v?void 0:v.complete)&&v.naturalWidth>0){if(n.save(),m&&(n.translate(h+y/2,b+f/2),n.rotate(-.12),n.translate(-(h+y/2),-(b+f/2))),p){let e=1.5*f;n.drawImage(v,h-.5*y,j.current.y-e+2,2.2*y,e)}else n.drawImage(v,h-.55*y,b-.65*f,2.1*y,2.1*f);n.restore()}else{let e=Math.max(10,Math.min(y,f)/2);n.save(),n.beginPath(),n.arc(h+y/2,b+f/2,e,0,2*Math.PI),n.closePath(),n.fillStyle="#ffd6ff",n.shadowColor="rgba(255,43,214,0.75)",n.shadowBlur=16,n.fill(),n.shadowBlur=0,n.lineWidth=2,n.strokeStyle="rgba(255,43,214,0.95)",n.stroke(),p&&(n.strokeStyle="rgba(255,255,255,0.55)",n.lineWidth=2,n.beginPath(),n.moveTo(h-10,j.current.y-2),n.lineTo(h+y+18,j.current.y-2),n.stroke()),n.restore()}if(N.current){for(let e of(n.save(),n.strokeStyle="rgba(255,255,255,0.65)",n.lineWidth=1,n.strokeRect(h,b,y,f),n.strokeStyle="rgba(251,191,36,0.75)",C.current)){let t=r-e.h;n.strokeRect(e.x,t,e.w,e.h)}n.restore()}n.fillStyle="rgba(255,255,255,0.85)",n.font="600 14px ui-monospace, SFMono-Regular, Menlo, monospace","ready"===x.current?n.fillText("Tap to JUMP • hold to SLIDE",14,22):"crashed"===x.current&&n.fillText("CRASHED",14,22),N.current&&(n.save(),n.fillStyle="rgba(0,0,0,0.55)",n.fillRect(10,10,240,74),n.strokeStyle="rgba(34,211,238,0.7)",n.lineWidth=1,n.strokeRect(10,10,240,74),n.fillStyle="rgba(255,255,255,0.92)",n.font="12px ui-monospace, SFMono-Regular, Menlo, monospace",n.fillText("debug: ON (press 'd' to toggle)",16,28),n.fillText("obstacles: ".concat(C.current.length),16,44),n.fillText("canvas: ".concat(Math.round(t),"x").concat(Math.round(a)," dpr:").concat(Math.round(window.devicePixelRatio||1)),16,60),n.fillText("status: ".concat(x.current),16,76),n.restore());let S=n.createRadialGradient(t/2,a/2,.2*Math.min(t,a),t/2,a/2,.75*Math.max(t,a));S.addColorStop(0,"rgba(0,0,0,0)"),S.addColorStop(1,"rgba(0,0,0,0.55)"),n.fillStyle=S,n.fillRect(0,0,t,a)})(),f.current=requestAnimationFrame(u)};return f.current=requestAnimationFrame(u),()=>{f.current&&cancelAnimationFrame(f.current),f.current=null,window.removeEventListener("resize",s),window.removeEventListener("keydown",l)}},[t,F]);let q=(0,d.useRef)(null),G=(0,d.useRef)(0),Q=(0,d.useRef)(!1),X=()=>{q.current&&window.clearTimeout(q.current),q.current=null};return(0,a.jsxs)("div",{className:"dash-root",style:{position:"relative"},onPointerDown:e=>{e.preventDefault(),t&&"crashed"!==x.current&&(G.current=Date.now(),Q.current=!1,X(),q.current=window.setTimeout(()=>{Q.current=!0,function(e){if(t&&(O(),"running"===x.current)){if(e<j.current.slidingUntil){j.current.dashingUntil=e+F.dashMs;return}j.current.slidingUntil=e+F.slideMs}}(Date.now())},F.holdToSlideMs))},onPointerUp:e=>{if(e.preventDefault(),!t||(X(),"crashed"===x.current))return;let n=Date.now()-G.current;Q.current||n>=F.holdToSlideMs||function(e){var n,a;if(!t||(O(),"running"!==x.current))return;let r=null!=(a=null==(n=y.current)?void 0:n.clientHeight)?a:0;if(!r)return;let i=r-F.groundPad;T.current=Math.max(T.current,e+F.jumpBufferMs),H(e,i)}(Date.now())},onPointerCancel:()=>{X()},onContextMenu:e=>e.preventDefault(),children:[(0,a.jsx)("div",{style:{position:"absolute",top:0,left:0,width:42,height:42,opacity:.01},onPointerDown:e=>{e.preventDefault();let t=e.currentTarget,n=Date.now(),a=Number(t.dataset.lastTap||0),r=Number(t.dataset.taps||0),i=n-a<550?r+1:1;t.dataset.lastTap=String(n),t.dataset.taps=String(i),i>=5&&(t.dataset.taps="0",M(e=>!e))}}),(0,a.jsx)("canvas",{ref:y,className:"dash-canvas"})]})}function v(e){let{address:t,demo:n}=e,r=!!n,[l,u]=(0,d.useState)(null),[o,v]=(0,d.useState)([]),[w,S]=(0,d.useState)(0),[M,N]=(0,d.useState)(0n),[j,C]=(0,d.useState)(!1),[R,E]=(0,d.useState)(0),[I,T]=(0,d.useState)(0),[k,P]=(0,d.useState)(0n),[A,_]=(0,d.useState)(0n),[D,B]=(0,d.useState)(0),[F,L]=(0,d.useState)(!1),[O,H]=(0,d.useState)(!1),[U,W]=(0,d.useState)(0),[z,q]=(0,d.useState)(null),G=(0,d.useRef)(null),[Q,X]=(0,d.useState)(0);(0,d.useEffect)(()=>()=>{G.current&&window.clearTimeout(G.current),G.current=null},[]);let J=(0,c.e)(),V=(0,i.i)(),{switchChainAsync:Y}=(0,s.R)(),{writeContractAsync:K,isPending:Z}=(0,p.x)(),[$,ee]=(0,d.useState)(!1),[et,en]=(0,d.useState)(null),[ea,er]=(0,d.useState)(!1),[ei]=(0,d.useState)(.01),[es,el]=(0,d.useState)(0),[eu,eo]=(0,d.useState)([]),[ed,ec]=(0,d.useState)(1),[ep,em]=(0,d.useState)(0),[ey,ef]=(0,d.useState)(0n),[eh,eb]=(0,d.useState)(0n);(0,d.useEffect)(()=>{if(!r||null!==et)return;let e=Math.floor(Date.now()/1e3);u(0n),en(e+120),eo([t,"0x000000000000000000000000000000000000dEaD","0x000000000000000000000000000000000000bEEF"]),v([{address:t,score:0n},{address:"0x000000000000000000000000000000000000dEaD",score:3n},{address:"0x000000000000000000000000000000000000bEEF",score:1n}]),el(.03),ee(!0),ec(1),em(0),ef(0n),eb(0n),L(!1),N(0n)},[r,et,t]),(0,d.useEffect)(()=>{if(!r||!et)return;let e=()=>{S(Math.max(0,et-Math.floor(Date.now()/1e3)))};e();let t=setInterval(e,1e3);return()=>clearInterval(t)},[r,et]),(0,d.useEffect)(()=>{if(!r||ea)return;let e=setInterval(()=>{v(e=>{let n=e.map(e=>({...e}));for(let e of n)e.address.toLowerCase()!==t.toLowerCase()&&.55>Math.random()&&(e.score=e.score+1n);return n.sort((e,t)=>t.score>e.score?1:t.score<e.score?-1:0),n})},2500);return()=>clearInterval(e)},[r,ea,t]);let{data:ex,refetch:eg}=(0,m.Q)({address:x,abi:b,functionName:"nextRoundId",query:{enabled:!r}});(0,d.useEffect)(()=>{!r&&void 0!==ex&&ex>0n&&u(ex-1n)},[ex,r]);let{data:ev,refetch:ew}=(0,m.Q)({address:x,abi:b,functionName:"rounds",args:null!==l?[l]:void 0,query:{enabled:!r&&null!==l}}),{data:eS,refetch:eM}=(0,m.Q)({address:x,abi:b,functionName:"joined",args:null!==l?[l,t]:void 0,query:{enabled:!r&&null!==l}}),{data:eN,refetch:ej}=(0,m.Q)({address:x,abi:b,functionName:"entryIndex",args:null!==l?[l,t]:void 0,query:{enabled:!r&&null!==l}}),{data:eC,refetch:eR}=(0,m.Q)({address:x,abi:b,functionName:"attemptsUsed",args:null!==l?[l,t]:void 0,query:{enabled:!r&&null!==l}}),{data:eE,refetch:eI}=(0,m.Q)({address:x,abi:b,functionName:"currentAttemptScore",args:null!==l?[l,t]:void 0,query:{enabled:!r&&null!==l}}),{data:eT,refetch:ek}=(0,m.Q)({address:x,abi:b,functionName:"totalScore",args:null!==l?[l,t]:void 0,query:{enabled:!r&&null!==l}}),[eP,eA,e_,eD,eB,eF,eL]=null!=ev?ev:[void 0,0n,0n,0n,0n,!1,0n],eO=et?BigInt(et):0n,eH=r?eO:null!=eD?eD:0n,eU=r?ea:null!=eF&&eF,eW=r?(0,f.g)(ei.toString()):null!=eA?eA:0n,ez=r?(0,f.g)(es.toString()):null!=eB?eB:0n,eq=r?BigInt(eu.length):null!=eL?eL:0n,eG=r?$:null!=eS&&eS,eQ=BigInt(Math.floor(Date.now()/1e3)),eX=eH>0n&&eQ<eH&&!eU,eJ=eH>0n&&eQ>=eH;(0,d.useEffect)(()=>{if(!eX){L(!1),H(!1);return}r?(X(ed),T(ep),P(ey),_(eh+ey)):(X(Number(null!=eN?eN:0)),T(Number(null!=eC?eC:0)),P(null!=eE?eE:0n),_(null!=eT?eT:0n))},[eX,r,ed,ep,ey,eh,eN,eC,eE,eT]),(0,d.useEffect)(()=>{if(r||!eD||0n===eD)return;let e=()=>{S(Math.max(0,Number(eD)-Math.floor(Date.now()/1e3)))};e();let t=setInterval(e,1e3);return()=>clearInterval(t)},[eD,r]);let eV=(0,d.useCallback)(async()=>{if(!r&&null!==l&&J)try{let e=await J.readContract({address:x,abi:b,functionName:"getPlayers",args:[l]}),n=await Promise.all(e.map(async e=>{let t=await J.readContract({address:x,abi:b,functionName:"getScore",args:[l,e]});return{address:e,score:t}}));n.sort((e,t)=>t.score>e.score?1:t.score<e.score?-1:0),v(n);let a=n.find(e=>e.address.toLowerCase()===t.toLowerCase());a&&N(a.score)}catch(e){}},[l,J,t,r]);(0,d.useEffect)(()=>{eV()},[eV]),(0,d.useEffect)(()=>{if(r||!eX)return;let e=setInterval(eV,3e3);return()=>clearInterval(e)},[eX,eV,r]),(0,y.x)({address:x,abi:b,eventName:"ActionsSubmitted",enabled:!r,onLogs(){eV(),eR(),eI(),ek()}}),(0,y.x)({address:x,abi:b,eventName:"EntryStarted",enabled:!r,onLogs(){ej(),eR(),eI(),ek()}}),(0,y.x)({address:x,abi:b,eventName:"AttemptEnded",enabled:!r,onLogs(){eR(),eI(),ek(),eV()}});let eY=(0,d.useRef)(0),eK=(0,d.useRef)(null),eZ=(0,d.useRef)(0),e$=(0,d.useRef)(0),e0=eX&&eG&&Q>0&&!F&&I<3&&!O;(0,d.useEffect)(()=>{if(!e0)return void B(0);let e=0,t=0,n=a=>{a-t>=50&&(t=a,B(eY.current)),e=requestAnimationFrame(n)};return e=requestAnimationFrame(n),()=>cancelAnimationFrame(e)},[e0]);let e1=(0,d.useCallback)(async e=>{if(!e0)return;if(r){let e=Math.floor(eY.current);if(e<=0)return;eY.current-=e,ef(t=>t+BigInt(e)),v(n=>{let a=n.map(e=>({...e})),r=a.findIndex(e=>e.address.toLowerCase()===t.toLowerCase());return r>=0&&(a[r].score=a[r].score+BigInt(e)),a.sort((e,t)=>t.score>e.score?1:t.score<e.score?-1:0),a});return}if(!eX||!eG||null===l||eK.current)return;let n=Date.now(),a=Math.floor(eY.current);if(a<=0)return;let i=n-eZ.current;if(e||!(a<25)||!(i<3e3)){eY.current-=a,eK.current={amount:a},eZ.current=n;try{await K({address:x,abi:b,functionName:"submitActions",args:[l,BigInt(a)]}),eV(),eI(),ek()}catch(e){eY.current+=a}finally{eK.current=null}}},[e0,r,eX,eG,l,K,eV,t,eI,ek]),e2=(0,d.useCallback)(e=>{if(!e0||e<=0)return;eY.current+=e;let t=Date.now();t-e$.current>=50&&(e$.current=t,B(eY.current)),e1()},[e0,e1]);(0,d.useEffect)(()=>{if(!e0)return;let e=setInterval(()=>{e1()},500);return()=>clearInterval(e)},[e0,e1]);let e5=(0,d.useCallback)(async()=>{if(eX&&eG&&!O){H(!0);try{if(await e1(!0),r)eb(e=>e+ey+BigInt(Math.floor(eY.current))),ef(0n),eY.current=0,em(e=>Math.min(3,e+1));else{if(null===l)return;await K({address:x,abi:b,functionName:"endAttempt",args:[l]}),eR(),eI(),ek(),eV(),eY.current=0}}finally{H(!1)}}},[eX,eG,O,e1,r,ey,l,K,eR,eI,ek,eV]),e3=(0,d.useCallback)(async()=>{L(!0);try{await e5()}catch(e){}},[e5]);async function e6(){if(E(e=>e+1),console.log("[MegaRally] Create Round tapped"),r){let e=Math.floor(Date.now()/1e3);er(!1),en(e+120),v([{address:t,score:0n},{address:"0x000000000000000000000000000000000000dEaD",score:0n},{address:"0x000000000000000000000000000000000000bEEF",score:0n}]),el(.03),ee(!0),ec(1),em(0),ef(0n),eb(0n),eY.current=0,L(!1),N(0n);return}await K({address:x,abi:b,functionName:"createRound",args:[(0,f.g)("0.01"),120n]}),await eg()}async function e4(){if(r){ee(!0),ec(1),em(0),ef(0n),eb(0n),eY.current=0,L(!1);return}if(null!==l&&void 0!==eA){if(await K({address:x,abi:b,functionName:"startEntry",args:[l],value:eA}),await eM(),await ew(),ej(),eX)try{await K({address:x,abi:b,functionName:"startAttempt",args:[l]})}catch(e){}eR(),eI(),ek(),eV()}}async function e8(){if(eX){if(r){ec(e=>e+1),em(0),ef(0n),eb(0n),eY.current=0,L(!1);return}null!==l&&void 0!==eA&&(await K({address:x,abi:b,functionName:"startEntry",args:[l],value:eA}),ej(),eR(),eI(),ek(),eV(),eY.current=0,L(!1))}}async function e9(){if(r)return void er(!0);null!==l&&(await K({address:x,abi:b,functionName:"finalizeRound",args:[l]}),await ew(),eV())}let e7=(0,d.useMemo)(()=>[31337,6343],[]).includes(V);if(!r&&!e7)return(0,a.jsxs)("div",{className:"no-round",children:[(0,a.jsx)("p",{children:"Wrong network. This app isn’t deployed on your current chain."}),(0,a.jsx)("p",{style:{opacity:.8,fontSize:14},children:"Switch to Anvil (local) for now. MegaETH support will be enabled once the chain is live and we deploy the contract."}),(0,a.jsx)("button",{className:"action-btn",onClick:async()=>{try{await Y({chainId:31337})}catch(e){}},children:"Switch network"})]});if(r&&null===l)return(0,a.jsx)("div",{className:"no-round",children:(0,a.jsx)("p",{children:"Starting demo…"})});if(null===l||!r&&0n===ex)return(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"no-round",children:(0,a.jsx)("p",{children:"No rounds yet"})}),(0,a.jsx)("button",{className:"action-btn",onClick:e6,disabled:Z,children:Z?"Creating...":"Create Round (0.01 ETH, 2 min)"}),(0,a.jsxs)("div",{style:{textAlign:"center",marginTop:8,fontSize:12,opacity:.7},"aria-live":"polite",children:["Tap count: ",R]})]});let te=Math.min(3,I+1),tt=(0,d.useMemo)(()=>{var e;let n=null!=(e=null==l?void 0:l.toString())?e:"0",a=(null!=t?t:"0x0000000000000000000000000000000000000000").toLowerCase(),r=String(Q);return"".concat(V,":").concat(x,":").concat(n,":").concat(a,":").concat(r)},[V,l,t,Q]),tn=(0,d.useCallback)(e=>{q(e),G.current&&window.clearTimeout(G.current),G.current=window.setTimeout(()=>q(null),"perfect"===e?420:520)},[]),ta=Math.max(0,Math.trunc(D)),tr=k+BigInt(ta),ti=A+BigInt(ta);return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"card",children:[(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,a.jsxs)("h2",{children:["Round #",l.toString()]}),(0,a.jsx)("span",{className:"badge ".concat(eX?"badge-active":"badge-ended"),children:eU?"Finalized":eX?"Active":"Ended"})]}),!r&&(0,a.jsxs)("div",{className:"round-info",style:{marginTop:8},children:[(0,a.jsxs)("span",{children:["Entry: ",(0,h.c)(eW)," ETH"]}),(0,a.jsxs)("span",{children:["Pool: ",(0,h.c)(ez)," ETH"]}),(0,a.jsxs)("span",{children:["Players: ",eq.toString()]})]})]}),eX&&(0,a.jsxs)("div",{className:"dash-wrap",children:[(0,a.jsxs)("div",{className:"dash-topbar","aria-live":"polite",children:[(0,a.jsxs)("div",{className:"dash-topbar-left",children:[(0,a.jsx)("div",{className:"dash-topbar-label",children:"ENTRY"}),(0,a.jsxs)("div",{className:"dash-topbar-value",children:["#",Q]}),(0,a.jsx)("div",{className:"dash-topbar-label",style:{marginTop:6},children:"ATTEMPT"}),(0,a.jsxs)("div",{className:"dash-topbar-value",children:[te,"/",3]}),(0,a.jsx)("div",{className:"dash-topbar-label",style:{marginTop:6},children:"COMBO"}),(0,a.jsx)("div",{className:"dash-topbar-value",children:U})]}),(0,a.jsxs)("div",{className:"dash-topbar-score",children:[(0,a.jsx)("div",{className:"dash-topbar-label",children:"SCORE"}),(0,a.jsx)("div",{className:"dash-topbar-score-value",children:tr.toString()}),z&&(0,a.jsx)("div",{className:"dash-topbar-label",style:{marginTop:6,color:"perfect"===z?"#22d3ee":"#fbbf24"},children:"perfect"===z?"PERFECT":"NEAR"})]}),(0,a.jsxs)("div",{className:"dash-topbar-right",children:[(0,a.jsx)("div",{className:"dash-topbar-label",children:"TOTAL"}),(0,a.jsx)("div",{className:"dash-topbar-value",children:ti.toString()})]})]}),(0,a.jsx)("button",{className:"dash-standings",onClick:()=>C(!0),children:"Standings"}),(0,a.jsx)(g,{active:e0,entrySeedBase:tt,attemptNumber:te,onDistance:e2,onCrash:e3,onCombo:W,onFeedback:tn},"attempt-".concat(I,"-").concat(F?"over":"run")),!eG&&(0,a.jsx)("div",{className:"dash-overlay",children:(0,a.jsxs)("div",{className:"dash-overlay-inner",children:[(0,a.jsx)("p",{style:{marginBottom:10,opacity:.9},children:"Join to start dashing."}),(0,a.jsx)("button",{className:"action-btn",onClick:e4,disabled:Z,children:Z?"Joining...":r?"Join Round (demo)":"Join Round (".concat((0,h.c)(eW)," ETH)")})]})}),eG&&I>=3&&(0,a.jsx)("div",{className:"dash-overlay",children:(0,a.jsxs)("div",{className:"dash-overlay-inner",children:[(0,a.jsx)("p",{style:{marginBottom:10,opacity:.9},children:"All attempts used for this entry."}),(0,a.jsx)("p",{style:{marginBottom:12,opacity:.75,fontSize:13},children:"Leaderboard keeps your best entry. Start a new entry to retry with a new seed."}),(0,a.jsx)("button",{className:"action-btn",onClick:e8,disabled:Z,children:Z?"Starting...":r?"Start New Entry (demo)":"Start New Entry (".concat((0,h.c)(eW)," ETH)")})]})}),eG&&F&&I<3&&(0,a.jsx)("div",{className:"dash-overlay",children:(0,a.jsxs)("div",{className:"dash-overlay-inner",children:[(0,a.jsx)("p",{style:{marginBottom:6,fontWeight:800},children:"Attempt over"}),(0,a.jsxs)("p",{style:{marginBottom:12,opacity:.8,fontSize:13},children:["Attempt score: ",tr.toString()," • Total: ",ti.toString()]}),(0,a.jsx)("button",{className:"action-btn",onClick:async()=>{if(!r&&(null!=k?k:0n)>0n)try{await e5()}catch(e){}if(!r&&null!==l)try{await K({address:x,abi:b,functionName:"startAttempt",args:[l]}),eR(),eI(),ek()}catch(e){}L(!1),eY.current=0},disabled:O,children:O?"Locking...":"Next Attempt"})]})})]}),eJ&&!eU&&(0,a.jsx)("button",{className:"action-btn",onClick:e9,disabled:Z,children:Z?"Finalizing...":r?"Finalize (demo)":"Finalize Round"}),(eU||eJ)&&(0,a.jsx)("button",{className:"action-btn",onClick:e6,disabled:Z,children:Z?"Creating...":r?"Restart Demo Round":"Create New Round"}),j&&(0,a.jsx)("div",{className:"drawer-backdrop",onClick:()=>C(!1),children:(0,a.jsxs)("div",{className:"drawer",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"drawer-header",children:[(0,a.jsx)("h3",{children:"Standings"}),(0,a.jsx)("button",{className:"drawer-close",onClick:()=>C(!1),children:"Close"})]}),0===o.length?(0,a.jsx)("p",{style:{color:"var(--muted)"},children:"No players yet"}):(0,a.jsx)("ul",{className:"leaderboard",children:o.map((e,n)=>{let r;return(0,a.jsxs)("li",{children:[(0,a.jsxs)("span",{className:"rank",children:["#",n+1]}),(0,a.jsx)("span",{className:"addr",children:e.address.toLowerCase()===t.toLowerCase()?"You":(r=e.address,"".concat(r.slice(0,6),"...").concat(r.slice(-4)))}),(0,a.jsx)("span",{className:"score",children:e.score.toString()})]},e.address)})}),(0,a.jsxs)("div",{className:"status",style:{marginTop:10},children:["Attempt score: ",k.toString()," • Attempts used: ",I,"/",3]}),!r&&(0,a.jsx)("div",{className:"status",style:{marginTop:6},children:"Batched commits every ~3s (or when distance builds up). No per-action tx spam."})]})})]})}let w={chainId:"0x18C7",chainName:"MegaETH Testnet",rpcUrls:["https://carrot.megaeth.com/rpc"],nativeCurrency:{name:"Ether",symbol:"ETH",decimals:18},blockExplorerUrls:["https://megaeth-testnet-v2.blockscout.com/"]};async function S(e){let{currentChainId:t,switchChainAsync:n}=e;if(n&&6343!==t)try{await n({chainId:6343});return}catch(t){if(!function(e){var t,n,a,r,i,s,l,u,o,d;if(4902===(null!=(d=null!=(o=null!=(u=null==e?void 0:e.code)?u:null==e||null==(n=e.cause)?void 0:n.code)?o:null==e||null==(r=e.data)||null==(a=r.originalError)?void 0:a.code)?d:null==e||null==(l=e.cause)||null==(s=l.data)||null==(i=s.originalError)?void 0:i.code))return!0;let c=String(null!=(t=null==e?void 0:e.message)?t:"").toLowerCase();return c.includes("unrecognized chain")||c.includes("unknown chain")||c.includes("not added")}(t))throw t;let e=window.ethereum;if(!(null==e?void 0:e.request))throw t;await e.request({method:"wallet_addEthereumChain",params:[w]}),await n({chainId:6343})}}function M(){let{address:e,isConnected:t}=(0,r.F)(),n=(0,i.i)(),{switchChainAsync:c}=(0,s.R)(),{connect:p}=(0,l.e)(),{disconnect:m}=(0,u.u)(),y=(0,d.useRef)(!1);return(0,d.useEffect)(()=>{if(!t){y.current=!1;return}y.current||(y.current=!0,6343!==n&&S({currentChainId:n,switchChainAsync:c}).catch(()=>{}))},[!1,t,n,c]),(0,a.jsxs)("div",{className:"container",children:[(0,a.jsxs)("header",{className:"header",children:[(0,a.jsx)("h1",{children:"MegaRally"}),t?(0,a.jsxs)("button",{className:"connect-btn",onClick:()=>m(),children:[null==e?void 0:e.slice(0,6),"...",null==e?void 0:e.slice(-4)]}):(0,a.jsx)("button",{className:"connect-btn",onClick:()=>p({connector:(0,o.b)()}),children:"Connect"})]}),t?(0,a.jsx)(v,{address:e,demo:!1}):(0,a.jsx)("div",{className:"no-round",children:(0,a.jsx)("p",{children:"Connect your wallet to play"})})]})}},9249:(e,t,n)=>{Promise.resolve().then(n.bind(n,639))}},e=>{e.O(0,[496,109,441,255,358],()=>e(e.s=9249)),_N_E=e.O()}]);