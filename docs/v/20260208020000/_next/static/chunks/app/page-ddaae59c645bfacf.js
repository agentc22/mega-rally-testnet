(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{639:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>M});var a=n(5155),r=n(4520),i=n(4935),s=n(4045),l=n(2139),u=n(2115),o=n(556),d=n(9941),c=n(3195),p=n(7417),m=n(6369),y=n(161),f=n(4710),h=n(8245);let b=[{type:"constructor",inputs:[{name:"_feeReceiver",type:"address"}],stateMutability:"nonpayable"},{type:"function",name:"ACTION_COOLDOWN",inputs:[],outputs:[{name:"",type:"uint256"}],stateMutability:"view"},{type:"function",name:"FEE_BPS",inputs:[],outputs:[{name:"",type:"uint256"}],stateMutability:"view"},{type:"function",name:"MAX_ATTEMPTS",inputs:[],outputs:[{name:"",type:"uint8"}],stateMutability:"view"},{type:"function",name:"MAX_OBSTACLES_PER_SECOND",inputs:[],outputs:[{name:"",type:"uint8"}],stateMutability:"view"},{type:"function",name:"MAX_SCORE_PER_OBSTACLE",inputs:[],outputs:[{name:"",type:"uint32"}],stateMutability:"view"},{type:"function",name:"isOperator",inputs:[{name:"",type:"address"},{name:"",type:"address"}],outputs:[{name:"",type:"bool"}],stateMutability:"view"},{type:"function",name:"setOperator",inputs:[{name:"operator",type:"address"},{name:"allowed",type:"bool"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"obstaclePassed",inputs:[{name:"roundId",type:"uint256"},{name:"entryIndex_",type:"uint32"},{name:"obstacleCount_",type:"uint32"},{name:"deltaScore",type:"uint32"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"obstaclePassedFor",inputs:[{name:"roundId",type:"uint256"},{name:"player",type:"address"},{name:"entryIndex_",type:"uint32"},{name:"obstacleCount_",type:"uint32"},{name:"deltaScore",type:"uint32"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"attemptsUsed",inputs:[{name:"roundId",type:"uint256"},{name:"player",type:"address"}],outputs:[{name:"",type:"uint8"}],stateMutability:"view"},{type:"function",name:"currentAttemptScore",inputs:[{name:"roundId",type:"uint256"},{name:"player",type:"address"}],outputs:[{name:"",type:"uint256"}],stateMutability:"view"},{type:"function",name:"totalScore",inputs:[{name:"roundId",type:"uint256"},{name:"player",type:"address"}],outputs:[{name:"",type:"uint256"}],stateMutability:"view"},{type:"function",name:"entryIndex",inputs:[{name:"roundId",type:"uint256"},{name:"player",type:"address"}],outputs:[{name:"",type:"uint32"}],stateMutability:"view"},{type:"function",name:"startEntry",inputs:[{name:"roundId",type:"uint256"}],outputs:[],stateMutability:"payable"},{type:"function",name:"startAttempt",inputs:[{name:"roundId",type:"uint256"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"endAttempt",inputs:[{name:"roundId",type:"uint256"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"createRound",inputs:[{name:"entryFee",type:"uint256"},{name:"duration",type:"uint256"}],outputs:[{name:"roundId",type:"uint256"}],stateMutability:"nonpayable"},{type:"function",name:"finalizeRound",inputs:[{name:"roundId",type:"uint256"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"getPlayers",inputs:[{name:"roundId",type:"uint256"}],outputs:[{name:"",type:"address[]"}],stateMutability:"view"},{type:"function",name:"getScore",inputs:[{name:"roundId",type:"uint256"},{name:"player",type:"address"}],outputs:[{name:"",type:"uint256"}],stateMutability:"view"},{type:"function",name:"joinRound",inputs:[{name:"roundId",type:"uint256"}],outputs:[],stateMutability:"payable"},{type:"function",name:"joined",inputs:[{name:"",type:"uint256"},{name:"",type:"address"}],outputs:[{name:"",type:"bool"}],stateMutability:"view"},{type:"function",name:"nextRoundId",inputs:[],outputs:[{name:"",type:"uint256"}],stateMutability:"view"},{type:"function",name:"rounds",inputs:[{name:"",type:"uint256"}],outputs:[{name:"creator",type:"address"},{name:"entryFee",type:"uint256"},{name:"startTime",type:"uint256"},{name:"endTime",type:"uint256"},{name:"pool",type:"uint256"},{name:"finalized",type:"bool"},{name:"playerCount",type:"uint256"}],stateMutability:"view"},{type:"function",name:"submitAction",inputs:[{name:"roundId",type:"uint256"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"submitActions",inputs:[{name:"roundId",type:"uint256"},{name:"amount",type:"uint256"}],outputs:[],stateMutability:"nonpayable"},{type:"event",name:"EntryStarted",inputs:[{name:"roundId",type:"uint256",indexed:!0},{name:"player",type:"address",indexed:!0},{name:"entryIndex",type:"uint32",indexed:!1}]},{type:"event",name:"AttemptStarted",inputs:[{name:"roundId",type:"uint256",indexed:!0},{name:"player",type:"address",indexed:!0},{name:"entryIndex",type:"uint32",indexed:!1},{name:"attemptNumber",type:"uint8",indexed:!1}]},{type:"event",name:"AttemptEnded",inputs:[{name:"roundId",type:"uint256",indexed:!0},{name:"player",type:"address",indexed:!0},{name:"entryIndex",type:"uint32",indexed:!1},{name:"attemptsUsed",type:"uint8",indexed:!1},{name:"attemptScore",type:"uint256",indexed:!1},{name:"entryTotalScore",type:"uint256",indexed:!1},{name:"bestScore",type:"uint256",indexed:!1}]},{type:"event",name:"OperatorSet",inputs:[{name:"player",type:"address",indexed:!0},{name:"operator",type:"address",indexed:!0},{name:"allowed",type:"bool",indexed:!1}]},{type:"event",name:"ObstaclePassed",inputs:[{name:"roundId",type:"uint256",indexed:!0},{name:"player",type:"address",indexed:!0},{name:"entryIndex",type:"uint32",indexed:!0},{name:"obstacleCount",type:"uint32",indexed:!1},{name:"deltaScore",type:"uint32",indexed:!1},{name:"attemptScore",type:"uint256",indexed:!1},{name:"bestScore",type:"uint256",indexed:!1}]},{type:"event",name:"ActionsSubmitted",inputs:[{name:"roundId",type:"uint256",indexed:!0},{name:"player",type:"address",indexed:!0},{name:"amount",type:"uint256",indexed:!1},{name:"newScore",type:"uint256",indexed:!1}]},{type:"event",name:"ActionSubmitted",inputs:[{name:"roundId",type:"uint256",indexed:!0},{name:"player",type:"address",indexed:!0},{name:"newScore",type:"uint256",indexed:!1}]},{type:"event",name:"RoundCreated",inputs:[{name:"roundId",type:"uint256",indexed:!0},{name:"creator",type:"address",indexed:!0},{name:"entryFee",type:"uint256",indexed:!1},{name:"startTime",type:"uint256",indexed:!1},{name:"endTime",type:"uint256",indexed:!1}]},{type:"event",name:"RoundFinalized",inputs:[{name:"roundId",type:"uint256",indexed:!0},{name:"winner",type:"address",indexed:!0},{name:"payout",type:"uint256",indexed:!1},{name:"fee",type:"uint256",indexed:!1}]},{type:"event",name:"RoundJoined",inputs:[{name:"roundId",type:"uint256",indexed:!0},{name:"player",type:"address",indexed:!0}]}],x="0x8Cf51b3e1137C88961edBcb24F374c241C0EC472",g={chainId:"0x18C7",chainName:"MegaETH Testnet",rpcUrls:["https://carrot.megaeth.com/rpc"],nativeCurrency:{name:"Ether",symbol:"ETH",decimals:18},blockExplorerUrls:["https://megaeth-testnet-v2.blockscout.com/"]};async function v(e){let{currentChainId:t,switchChainAsync:n}=e;if(n&&6343!==t)try{await n({chainId:6343});return}catch(t){if(!function(e){var t,n,a,r,i,s,l,u,o,d;if(4902===(null!=(d=null!=(o=null!=(u=null==e?void 0:e.code)?u:null==e||null==(n=e.cause)?void 0:n.code)?o:null==e||null==(r=e.data)||null==(a=r.originalError)?void 0:a.code)?d:null==e||null==(l=e.cause)||null==(s=l.data)||null==(i=s.originalError)?void 0:i.code))return!0;let c=String(null!=(t=null==e?void 0:e.message)?t:"").toLowerCase();return c.includes("unrecognized chain")||c.includes("unknown chain")||c.includes("not added")}(t))throw t;let e=window.ethereum;if(!(null==e?void 0:e.request))throw t;await e.request({method:"wallet_addEthereumChain",params:[g]}),await n({chainId:6343})}}function w(e){let{active:t,onDistance:n,onCrash:r,entrySeedBase:i,attemptNumber:s,onCombo:l,onFeedback:o}=e,d=(0,u.useRef)(n),c=(0,u.useRef)(r),p=(0,u.useRef)(l),m=(0,u.useRef)(o);(0,u.useEffect)(()=>{d.current=n},[n]),(0,u.useEffect)(()=>{c.current=r},[r]),(0,u.useEffect)(()=>{p.current=l},[l]),(0,u.useEffect)(()=>{m.current=o},[o]);let y=(0,u.useRef)(null),f=(0,u.useRef)(null),[h,b]=(0,u.useState)("ready"),x=(0,u.useRef)("ready"),[g,v]=(0,u.useState)(0),w=(0,u.useRef)(0),[S,M]=(0,u.useState)(!1),N=(0,u.useRef)(!1);(0,u.useEffect)(()=>{N.current=S},[S]);let j=(0,u.useRef)({y:0,vy:0,slidingUntil:0,dashingUntil:0}),C=(0,u.useRef)([]),R=(0,u.useRef)(0),E=(0,u.useRef)(0),I=(0,u.useRef)(0),T=(0,u.useRef)(0),k=(0,u.useRef)(!1),P=(0,u.useRef)(0x12345678),_=(e,t,n)=>e+(t-e)*n,A=e=>{let t=Math.max(0,Math.min(1,e));return t*t*(3-2*t)},D=e=>e<=8?.3*A(e/8):e<=24?_(.3,.65,A((e-8)/16)):e<=70?_(.65,1,A((e-24)/46)):1,F=()=>{let e=0|P.current;return e^=e<<13,e^=e>>>17,P.current=0|(e^=e<<5),(e>>>0)/0x100000000},B=(0,u.useMemo)(()=>({gravity:2400,jumpVy:-820,difficulty:{speed:{start:280,end:520,maxDashBonus:80},spawnGapPx:{start:520,end:190,min:175,jitterFrac:.18},hitboxPadPx:{start:8,end:2},highObstacleHeight:{start:40,end:52},highObstacleChance:{start:.18,end:.48}},obstacleW:34,runnerX:82,runnerW:22,runnerH:34,runnerSlideH:18,groundPad:24,slideMs:420,dashMs:220,holdToSlideMs:180,coyoteMs:90,jumpBufferMs:110,startGraceDistancePx:520}),[]);function L(){var e;j.current={y:0,vy:0,slidingUntil:0,dashingUntil:0},C.current=[],R.current=0,w.current=0,v(0),k.current=!1,E.current=0,null==(e=p.current)||e.call(p,0),P.current=(e=>{let t=0x811c9dc5;for(let n=0;n<e.length;n++)t^=e.charCodeAt(n),t=Math.imul(t,0x1000193);return 0|t})("".concat(null!=i?i:"local","|").concat(null!=s?s:1)),I.current=performance.now(),T.current=0,x.current="ready",b("ready")}function H(){t&&"ready"===x.current&&(x.current="running",b("running"))}(0,u.useEffect)(()=>{if(!t)return void L();L(),x.current="running",b("running")},[t,i,s]);let O=(e,t)=>!(T.current<=e)&&(.01>Math.abs(j.current.y-t)||e-I.current<=B.coyoteMs)&&(j.current.vy=B.jumpVy,T.current=0,!0),U=(0,u.useRef)({}),[W,z]=(0,u.useState)(0);(0,u.useEffect)(()=>{let e=(e,t)=>{if(U.current[e])return;let n=new Image;n.decoding="async",n.loading="eager",n.src=t,n.onload=()=>z(e=>e+1),U.current[e]=n},t="/mega-rally-testnet/v/20260208020000",n=e=>new URL("".concat(t).concat(e),window.location.origin).toString();e("fluffle_run1",n("/sprites/fluffle_run1.svg")),e("fluffle_run2",n("/sprites/fluffle_run2.svg")),e("fluffle_slide",n("/sprites/fluffle_slide.svg")),e("ob_shard",n("/sprites/obstacle_shard.svg")),e("ob_drone",n("/sprites/obstacle_drone.svg")),e("ob_pylon",n("/sprites/obstacle_pylon.svg")),e("ob_tree",n("/sprites/obstacle_tree.svg"))},[]),(0,u.useEffect)(()=>{if(!t){f.current&&cancelAnimationFrame(f.current),f.current=null,x.current="ready",b("ready");return}let e=y.current;if(!e)return;let n=e.getContext("2d");if(!n)return;let a=performance.now(),r=B.startGraceDistancePx,i=performance.now(),s=()=>{let t=Math.max(1,Math.floor(window.devicePixelRatio||1)),{width:a,height:r}=e.getBoundingClientRect();e.width=Math.floor(a*t),e.height=Math.floor(r*t),n.setTransform(t,0,0,t,0,0);let i=r-B.groundPad;0===j.current.y&&(j.current.y=i)};s(),window.addEventListener("resize",s);let l=e=>{"d"===e.key.toLowerCase()&&M(e=>!e)};window.addEventListener("keydown",l);let u=t=>{let s=Math.min(.033,(t-a)/1e3);if(a=t,"running"===x.current){var l,o,y,h,g;let n=D(R.current),a=performance.now(),u=a<j.current.dashingUntil,f=_(B.difficulty.speed.start,B.difficulty.speed.end,n)+(u?B.difficulty.speed.maxDashBonus:0),S=e.clientWidth,M=e.clientHeight-B.groundPad;if(j.current.vy+=B.gravity*s,j.current.y+=j.current.vy*s,j.current.y>M?(j.current.y=M,j.current.vy=0,I.current=a):.01>Math.abs(j.current.y-M)&&(I.current=a),O(a,M),w.current>=r){let e=_(B.difficulty.highObstacleChance.start,B.difficulty.highObstacleChance.end,n),t=F()<1-e?"low":"high",a=Math.round(_(B.difficulty.highObstacleHeight.start,B.difficulty.highObstacleHeight.end,n)),i="low"===t?["ob_shard","ob_pylon","ob_tree"]:["ob_drone"],s=i[Math.floor(F()*i.length)]||("low"===t?"ob_shard":"ob_drone");C.current.push({x:S+40,w:B.obstacleW,h:"low"===t?26:a,kind:t,skin:s});let l=_(B.difficulty.spawnGapPx.start,B.difficulty.spawnGapPx.end,n),u=(2*F()-1)*B.difficulty.spawnGapPx.jitterFrac,o=Math.max(B.difficulty.spawnGapPx.min,l*(1+u));r=w.current+o}for(let e of C.current)e.x-=f*s;for(let e of(a<j.current.slidingUntil?B.runnerSlideH:B.runnerH,j.current.y,C.current))if(!e.passed&&e.x+e.w<B.runnerX&&(e.passed=!0,R.current+=1,E.current+=1,null==(l=p.current)||l.call(p,E.current),"low"===e.kind)){let t=M-e.h-j.current.y;t>=0&&t<=3?null==(o=m.current)||o.call(m,"perfect"):t>=0&&t<=8&&(null==(y=m.current)||y.call(m,"near"))}C.current=C.current.filter(e=>e.x>-e.w-20);let N=f*s;w.current+=N,d.current(N/10),t-i>250&&(i=t,v(w.current)),(()=>{let t=e.clientWidth,n=e.clientHeight;if(!t||!n)return!1;let a=n-B.groundPad,r=performance.now(),i=r<j.current.slidingUntil,s=r<j.current.dashingUntil,l=B.runnerX,u=B.runnerW,o=i?B.runnerSlideH:B.runnerH,d=j.current.y-o,c=D(R.current),p=Math.round(_(B.difficulty.hitboxPadPx.start,B.difficulty.hitboxPadPx.end,c)+3*!!s);for(let e of C.current){let t=e.x,n=a-e.h,r=e.w,i=e.h;if(l+p<t+r&&l+u-p>t&&d+p<n+i&&d+o-p>n)return!0}return!1})()&&(x.current="crashed",b("crashed"),E.current=0,null==(h=p.current)||h.call(p,0),k.current||(k.current=!0,null==(g=c.current)||g.call(c)))}(()=>{let t=e.clientWidth,a=e.clientHeight,r=a-B.groundPad,i=D(R.current),s="rgba(".concat(Math.round(7+10*i),",").concat(Math.round(10+8*i),",").concat(Math.round(22+28*i),",1)"),l=n.createLinearGradient(0,0,0,a);l.addColorStop(0,s),l.addColorStop(1,"rgba(7,10,18,1)"),n.fillStyle=l,n.fillRect(0,0,t,a);let u=Math.round(.18*a),o=Math.round(.34*a),d=.06*w.current%44;for(let e=-2;e<Math.ceil(t/44)+2;e++){let t=Math.floor(.06*w.current/44)+e,a=Math.round(40+Math.abs(Math.sin(999.13*t))%1*o),r=44*e-d,i=u+(o-a);n.fillStyle="rgba(11,18,32,0.85)",n.fillRect(r,i,38,a);let s=.18+.12*Math.sin(.002*w.current+t);n.fillStyle="rgba(34,211,238,".concat(Math.max(0,s),")"),n.fillRect(r+10,i+14,6,2),n.fillStyle="rgba(255,43,214,".concat(Math.max(0,.7*s),")"),n.fillRect(r+22,i+22,8,2)}n.fillStyle="rgba(255,255,255,0.03)";for(let e=0;e<a;e+=4)n.fillRect(0,e,t,1);n.strokeStyle="rgba(34,211,238,0.18)",n.lineWidth=1;for(let e=0;e<t;e+=28)n.beginPath(),n.moveTo(e-.6*w.current%28,r),n.lineTo(e-.6*w.current%28,a),n.stroke();let c=n.createLinearGradient(0,r,0,a);for(let e of(c.addColorStop(0,"rgba(34,211,238,0.18)"),c.addColorStop(1,"rgba(0,0,0,0.0)"),n.fillStyle=c,n.fillRect(0,r,t,a-r),C.current)){let t=r-e.h,a=U.current[e.skin];if((null==a?void 0:a.complete)&&a.naturalWidth>0){if(n.save(),"low"===e.kind)n.drawImage(a,e.x-10,t-18,e.w+20,e.h+30);else{let r=Math.max(24,Math.round(.6*e.h));n.drawImage(a,e.x-22,t-r,e.w+44,e.h+r+30)}n.restore();continue}if(n.save(),n.lineWidth=2,n.strokeStyle="rgba(0,0,0,0.75)","low"===e.kind){let a=e.w/4;n.beginPath(),n.moveTo(e.x,r);for(let i=0;i<4;i++){let s=e.x+i*a;n.lineTo(s+a/2,t),n.lineTo(s+a,r)}n.closePath(),n.fillStyle="#fbbf24",n.fill(),n.stroke()}else n.fillStyle="#22d3ee",n.fillRect(e.x,t,e.w,e.h),n.strokeRect(e.x,t,e.w,e.h);n.restore()}let p=performance.now()<j.current.slidingUntil,m=j.current.y<r-1,y=B.runnerW,f=p?B.runnerSlideH:B.runnerH,h=B.runnerX,b=j.current.y-f,g=Math.floor(w.current/80%2),v=U.current[p?"fluffle_slide":0===g?"fluffle_run1":"fluffle_run2"];if((null==v?void 0:v.complete)&&v.naturalWidth>0){if(n.save(),m&&(n.translate(h+y/2,b+f/2),n.rotate(-.12),n.translate(-(h+y/2),-(b+f/2))),p){let e=1.5*f;n.drawImage(v,h-.5*y,j.current.y-e+2,2.2*y,e)}else n.drawImage(v,h-.55*y,b-.65*f,2.1*y,2.1*f);n.restore()}else{let e=Math.max(10,Math.min(y,f)/2);n.save(),n.beginPath(),n.arc(h+y/2,b+f/2,e,0,2*Math.PI),n.closePath(),n.fillStyle="#ffd6ff",n.shadowColor="rgba(255,43,214,0.75)",n.shadowBlur=16,n.fill(),n.shadowBlur=0,n.lineWidth=2,n.strokeStyle="rgba(255,43,214,0.95)",n.stroke(),p&&(n.strokeStyle="rgba(255,255,255,0.55)",n.lineWidth=2,n.beginPath(),n.moveTo(h-10,j.current.y-2),n.lineTo(h+y+18,j.current.y-2),n.stroke()),n.restore()}if(N.current){for(let e of(n.save(),n.strokeStyle="rgba(255,255,255,0.65)",n.lineWidth=1,n.strokeRect(h,b,y,f),n.strokeStyle="rgba(251,191,36,0.75)",C.current)){let t=r-e.h;n.strokeRect(e.x,t,e.w,e.h)}n.restore()}n.fillStyle="rgba(255,255,255,0.85)",n.font="600 14px ui-monospace, SFMono-Regular, Menlo, monospace","ready"===x.current?n.fillText("Tap to JUMP • hold to SLIDE",14,22):"crashed"===x.current&&n.fillText("CRASHED",14,22),N.current&&(n.save(),n.fillStyle="rgba(0,0,0,0.55)",n.fillRect(10,10,240,74),n.strokeStyle="rgba(34,211,238,0.7)",n.lineWidth=1,n.strokeRect(10,10,240,74),n.fillStyle="rgba(255,255,255,0.92)",n.font="12px ui-monospace, SFMono-Regular, Menlo, monospace",n.fillText("debug: ON (press 'd' to toggle)",16,28),n.fillText("obstacles: ".concat(C.current.length),16,44),n.fillText("canvas: ".concat(Math.round(t),"x").concat(Math.round(a)," dpr:").concat(Math.round(window.devicePixelRatio||1)),16,60),n.fillText("status: ".concat(x.current),16,76),n.restore());let S=n.createRadialGradient(t/2,a/2,.2*Math.min(t,a),t/2,a/2,.75*Math.max(t,a));S.addColorStop(0,"rgba(0,0,0,0)"),S.addColorStop(1,"rgba(0,0,0,0.55)"),n.fillStyle=S,n.fillRect(0,0,t,a)})(),f.current=requestAnimationFrame(u)};return f.current=requestAnimationFrame(u),()=>{f.current&&cancelAnimationFrame(f.current),f.current=null,window.removeEventListener("resize",s),window.removeEventListener("keydown",l)}},[t,B]);let q=(0,u.useRef)(null),G=(0,u.useRef)(0),Q=(0,u.useRef)(!1),X=()=>{q.current&&window.clearTimeout(q.current),q.current=null};return(0,a.jsxs)("div",{className:"dash-root",style:{position:"relative"},onPointerDown:e=>{e.preventDefault(),t&&"crashed"!==x.current&&(G.current=Date.now(),Q.current=!1,X(),q.current=window.setTimeout(()=>{Q.current=!0,function(e){if(t&&(H(),"running"===x.current)){if(e<j.current.slidingUntil){j.current.dashingUntil=e+B.dashMs;return}j.current.slidingUntil=e+B.slideMs}}(Date.now())},B.holdToSlideMs))},onPointerUp:e=>{if(e.preventDefault(),!t||(X(),"crashed"===x.current))return;let n=Date.now()-G.current;Q.current||n>=B.holdToSlideMs||function(e){var n,a;if(!t||(H(),"running"!==x.current))return;let r=null!=(a=null==(n=y.current)?void 0:n.clientHeight)?a:0;if(!r)return;let i=r-B.groundPad;T.current=Math.max(T.current,e+B.jumpBufferMs),O(e,i)}(Date.now())},onPointerCancel:()=>{X()},onContextMenu:e=>e.preventDefault(),children:[(0,a.jsx)("div",{style:{position:"absolute",top:0,left:0,width:42,height:42,opacity:.01},onPointerDown:e=>{e.preventDefault();let t=e.currentTarget,n=Date.now(),a=Number(t.dataset.lastTap||0),r=Number(t.dataset.taps||0),i=n-a<550?r+1:1;t.dataset.lastTap=String(n),t.dataset.taps=String(i),i>=5&&(t.dataset.taps="0",M(e=>!e))}}),(0,a.jsx)("canvas",{ref:y,className:"dash-canvas"})]})}function S(e){let{address:t,demo:n}=e,r=!!n,[i,s]=(0,u.useState)(null),[l,g]=(0,u.useState)([]),[S,M]=(0,u.useState)(0),[N,j]=(0,u.useState)(0n),[C,R]=(0,u.useState)(!1),[E,I]=(0,u.useState)(0),[T,k]=(0,u.useState)(0),[P,_]=(0,u.useState)(0n),[A,D]=(0,u.useState)(0n),[F,B]=(0,u.useState)(0),[L,H]=(0,u.useState)(!1),[O,U]=(0,u.useState)(!1),[W,z]=(0,u.useState)(0),[q,G]=(0,u.useState)(null),Q=(0,u.useRef)(null),[X,J]=(0,u.useState)(0);(0,u.useEffect)(()=>()=>{Q.current&&window.clearTimeout(Q.current),Q.current=null},[]);let V=(0,o.e)(),Y=(0,d.i)(),{switchChainAsync:K}=(0,c.R)(),{writeContractAsync:Z,isPending:$}=(0,p.x)(),ee=r||6343===Y,[et,en]=(0,u.useState)(!1),[ea,er]=(0,u.useState)(null),[ei,es]=(0,u.useState)(!1),[el]=(0,u.useState)(.01),[eu,eo]=(0,u.useState)(0),[ed,ec]=(0,u.useState)([]),[ep,em]=(0,u.useState)(1),[ey,ef]=(0,u.useState)(0),[eh,eb]=(0,u.useState)(0n),[ex,eg]=(0,u.useState)(0n);(0,u.useEffect)(()=>{if(!r||null!==ea)return;let e=Math.floor(Date.now()/1e3);s(0n),er(e+120),ec([t,"0x000000000000000000000000000000000000dEaD","0x000000000000000000000000000000000000bEEF"]),g([{address:t,score:0n},{address:"0x000000000000000000000000000000000000dEaD",score:3n},{address:"0x000000000000000000000000000000000000bEEF",score:1n}]),eo(.03),en(!0),em(1),ef(0),eb(0n),eg(0n),H(!1),j(0n)},[r,ea,t]),(0,u.useEffect)(()=>{if(!r||!ea)return;let e=()=>{M(Math.max(0,ea-Math.floor(Date.now()/1e3)))};e();let t=setInterval(e,1e3);return()=>clearInterval(t)},[r,ea]),(0,u.useEffect)(()=>{if(!r||ei)return;let e=setInterval(()=>{g(e=>{let n=e.map(e=>({...e}));for(let e of n)e.address.toLowerCase()!==t.toLowerCase()&&.55>Math.random()&&(e.score=e.score+1n);return n.sort((e,t)=>t.score>e.score?1:t.score<e.score?-1:0),n})},2500);return()=>clearInterval(e)},[r,ei,t]);let{data:ev,refetch:ew}=(0,m.Q)({address:x,abi:b,functionName:"nextRoundId",query:{enabled:!r&&ee}});(0,u.useEffect)(()=>{!r&&void 0!==ev&&ev>0n&&s(ev-1n)},[ev,r]);let{data:eS,refetch:eM}=(0,m.Q)({address:x,abi:b,functionName:"rounds",args:null!==i?[i]:void 0,query:{enabled:!r&&ee&&null!==i}}),{data:eN}=(0,m.Q)({address:x,abi:b,functionName:"joined",args:null!==i?[i,t]:void 0,query:{enabled:!r&&ee&&null!==i}}),{data:ej,refetch:eC}=(0,m.Q)({address:x,abi:b,functionName:"entryIndex",args:null!==i?[i,t]:void 0,query:{enabled:!r&&ee&&null!==i}}),{data:eR,refetch:eE}=(0,m.Q)({address:x,abi:b,functionName:"attemptsUsed",args:null!==i?[i,t]:void 0,query:{enabled:!r&&ee&&null!==i}}),{data:eI,refetch:eT}=(0,m.Q)({address:x,abi:b,functionName:"currentAttemptScore",args:null!==i?[i,t]:void 0,query:{enabled:!r&&ee&&null!==i}}),{data:ek,refetch:eP}=(0,m.Q)({address:x,abi:b,functionName:"totalScore",args:null!==i?[i,t]:void 0,query:{enabled:!r&&ee&&null!==i}}),[e_,eA,eD,eF,eB,eL,eH]=null!=eS?eS:[void 0,0n,0n,0n,0n,!1,0n],eO=ea?BigInt(ea):0n,eU=r?eO:null!=eF?eF:0n,eW=r?ei:null!=eL&&eL,ez=r?(0,f.g)(el.toString()):null!=eA?eA:0n,eq=r?(0,f.g)(eu.toString()):null!=eB?eB:0n,eG=r?BigInt(ed.length):null!=eH?eH:0n,eQ=r?et:(null!=ej?ej:0)>0,eX=BigInt(Math.floor(Date.now()/1e3)),eJ=eU>0n&&eX<eU&&!eW,eV=eU>0n&&eX>=eU;(0,u.useEffect)(()=>{if(!eJ){H(!1),U(!1);return}r?(J(ep),k(ey),_(eh),D(ex+eh)):(J(Number(null!=ej?ej:0)),k(Number(null!=eR?eR:0)),_(null!=eI?eI:0n),D(null!=ek?ek:0n))},[eJ,r,ep,ey,eh,ex,ej,eR,eI,ek]),(0,u.useEffect)(()=>{if(r||!eF||0n===eF)return;let e=()=>{M(Math.max(0,Number(eF)-Math.floor(Date.now()/1e3)))};e();let t=setInterval(e,1e3);return()=>clearInterval(t)},[eF,r]);let eY=(0,u.useCallback)(async()=>{if(!r&&ee&&null!==i&&V)try{let e=await V.readContract({address:x,abi:b,functionName:"getPlayers",args:[i]}),n=await Promise.all(e.map(async e=>{let t=await V.readContract({address:x,abi:b,functionName:"getScore",args:[i,e]});return{address:e,score:t}}));n.sort((e,t)=>t.score>e.score?1:t.score<e.score?-1:0),g(n);let a=n.find(e=>e.address.toLowerCase()===t.toLowerCase());a&&j(a.score)}catch(e){}},[i,V,t,r,ee]);(0,u.useEffect)(()=>{eY()},[eY]),(0,u.useEffect)(()=>{if(r||!ee||!eJ)return;let e=setInterval(eY,3e3);return()=>clearInterval(e)},[eJ,eY,r,ee]),(0,y.x)({address:x,abi:b,eventName:"ActionsSubmitted",enabled:!r&&ee,onLogs(){eY(),eE(),eT(),eP()}}),(0,y.x)({address:x,abi:b,eventName:"EntryStarted",enabled:!r&&ee,onLogs(){eC(),eE(),eT(),eP()}}),(0,y.x)({address:x,abi:b,eventName:"AttemptEnded",enabled:!r&&ee,onLogs(){eE(),eT(),eP(),eY()}});let eK=(0,u.useRef)(0),eZ=(0,u.useRef)(null),e$=(0,u.useRef)(0),e0=(0,u.useRef)(0),e2=eJ&&eQ&&X>0&&!L&&T<3&&!O;(0,u.useEffect)(()=>{if(!e2)return void B(0);let e=0,t=0,n=a=>{a-t>=50&&(t=a,B(eK.current)),e=requestAnimationFrame(n)};return e=requestAnimationFrame(n),()=>cancelAnimationFrame(e)},[e2]);let e1=(0,u.useCallback)(async e=>{if(!e2)return;if(r){let e=Math.floor(eK.current);if(e<=0)return;eK.current-=e,eb(t=>t+BigInt(e)),g(n=>{let a=n.map(e=>({...e})),r=a.findIndex(e=>e.address.toLowerCase()===t.toLowerCase());return r>=0&&(a[r].score=a[r].score+BigInt(e)),a.sort((e,t)=>t.score>e.score?1:t.score<e.score?-1:0),a});return}if(!eJ||!eQ||null===i||eZ.current)return;let n=Date.now(),a=Math.floor(eK.current);if(a<=0)return;let s=n-e$.current;if(e||!(a<25)||!(s<3e3)){eK.current-=a,eZ.current={amount:a},e$.current=n;try{await Z({address:x,abi:b,functionName:"submitActions",args:[i,BigInt(a)]}),eY(),eT(),eP()}catch(e){eK.current+=a}finally{eZ.current=null}}},[e2,r,eJ,eQ,i,Z,eY,t,eT,eP]),e5=(0,u.useCallback)(e=>{if(!e2||e<=0)return;eK.current+=e;let t=Date.now();t-e0.current>=50&&(e0.current=t,B(eK.current)),e1()},[e2,e1]);(0,u.useEffect)(()=>{if(!e2)return;let e=setInterval(()=>{e1()},500);return()=>clearInterval(e)},[e2,e1]);let e6=(0,u.useCallback)(async()=>{if(eJ&&eQ&&!O){U(!0);try{if(await e1(!0),r)eg(e=>e+eh+BigInt(Math.floor(eK.current))),eb(0n),eK.current=0,ef(e=>Math.min(3,e+1));else{if(null===i)return;await Z({address:x,abi:b,functionName:"endAttempt",args:[i]}),eE(),eT(),eP(),eY(),eK.current=0}}finally{U(!1)}}},[eJ,eQ,O,e1,r,eh,i,Z,eE,eT,eP,eY]),e3=(0,u.useCallback)(async()=>{H(!0);try{await e6()}catch(e){}},[e6]);async function e4(){if(I(e=>e+1),console.log("[MegaRally] Create Round tapped"),r){let e=Math.floor(Date.now()/1e3);es(!1),er(e+120),g([{address:t,score:0n},{address:"0x000000000000000000000000000000000000dEaD",score:0n},{address:"0x000000000000000000000000000000000000bEEF",score:0n}]),eo(.03),en(!0),em(1),ef(0),eb(0n),eg(0n),eK.current=0,H(!1),j(0n);return}await Z({address:x,abi:b,functionName:"createRound",args:[(0,f.g)("0.01"),120n]}),await ew()}async function e8(){if(r){en(!0),em(1),ef(0),eb(0n),eg(0n),eK.current=0,H(!1);return}if(null===i||void 0===eA)return;let e=await Z({address:x,abi:b,functionName:"startEntry",args:[i],value:eA});try{V&&await V.waitForTransactionReceipt({hash:e})}catch(e){}if(await eM(),await eC(),eJ)try{let e=await Z({address:x,abi:b,functionName:"startAttempt",args:[i]});try{V&&await V.waitForTransactionReceipt({hash:e})}catch(e){}}catch(e){}eE(),eT(),eP(),eY()}async function e9(){if(!eJ)return;if(r){em(e=>e+1),ef(0),eb(0n),eg(0n),eK.current=0,H(!1);return}if(null===i||void 0===eA)return;let e=await Z({address:x,abi:b,functionName:"startEntry",args:[i],value:eA});try{V&&await V.waitForTransactionReceipt({hash:e})}catch(e){}eC(),eE(),eT(),eP(),eY(),eK.current=0,H(!1)}async function e7(){if(r)return void es(!0);null!==i&&(await Z({address:x,abi:b,functionName:"finalizeRound",args:[i]}),await eM(),eY())}let[te,tt]=(0,u.useState)(!1),tn=(0,u.useCallback)(async()=>{tt(!0);try{await v({currentChainId:Y,switchChainAsync:K})}catch(e){}finally{tt(!1)}},[Y,K]),ta=Math.min(3,T+1),tr=(0,u.useMemo)(()=>{var e;let n=null!=(e=null==i?void 0:i.toString())?e:"0",a=(null!=t?t:"0x0000000000000000000000000000000000000000").toLowerCase(),r=String(X);return"".concat(Y,":").concat(x,":").concat(n,":").concat(a,":").concat(r)},[Y,i,t,X]),ti=(0,u.useCallback)(e=>{G(e),Q.current&&window.clearTimeout(Q.current),Q.current=window.setTimeout(()=>G(null),"perfect"===e?420:520)},[]);if(!r&&6343!==Y)return(0,a.jsxs)("div",{className:"no-round",children:[(0,a.jsx)("p",{style:{marginBottom:8},children:"Wrong network."}),(0,a.jsxs)("p",{style:{opacity:.85,fontSize:14,marginBottom:12},children:["Switch your wallet to ",(0,a.jsx)("b",{children:"MegaETH Testnet"})," (chainId ",6343,")."]}),(0,a.jsx)("button",{className:"action-btn",onClick:tn,disabled:te,children:te?"Switching…":"Switch to MegaETH Testnet"})]});if(r&&null===i)return(0,a.jsx)("div",{className:"no-round",children:(0,a.jsx)("p",{children:"Starting demo…"})});if(null===i||!r&&0n===ev)return(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"no-round",children:(0,a.jsx)("p",{children:"No rounds yet"})}),(0,a.jsx)("button",{className:"action-btn",onClick:e4,disabled:$,children:$?"Creating...":"Create Round (0.01 ETH, 2 min)"}),(0,a.jsxs)("div",{style:{textAlign:"center",marginTop:8,fontSize:12,opacity:.7},"aria-live":"polite",children:["Tap count: ",E]})]});let ts=Math.max(0,Math.trunc(F)),tl=P+BigInt(ts),tu=A+BigInt(ts);return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"card",children:[(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,a.jsxs)("h2",{children:["Round #",i.toString()]}),(0,a.jsx)("span",{className:"badge ".concat(eJ?"badge-active":"badge-ended"),children:eW?"Finalized":eJ?"Active":"Ended"})]}),!r&&(0,a.jsxs)("div",{className:"round-info",style:{marginTop:8},children:[(0,a.jsxs)("span",{children:["Entry: ",(0,h.c)(ez)," ETH"]}),(0,a.jsxs)("span",{children:["Pool: ",(0,h.c)(eq)," ETH"]}),(0,a.jsxs)("span",{children:["Players: ",eG.toString()]})]})]}),eJ&&(0,a.jsxs)("div",{className:"dash-wrap",children:[(0,a.jsxs)("div",{className:"dash-topbar","aria-live":"polite",children:[(0,a.jsxs)("div",{className:"dash-topbar-left",children:[(0,a.jsx)("div",{className:"dash-topbar-label",children:"ENTRY"}),(0,a.jsxs)("div",{className:"dash-topbar-value",children:["#",X]}),(0,a.jsx)("div",{className:"dash-topbar-label",style:{marginTop:6},children:"ATTEMPT"}),(0,a.jsxs)("div",{className:"dash-topbar-value",children:[ta,"/",3]}),(0,a.jsx)("div",{className:"dash-topbar-label",style:{marginTop:6},children:"COMBO"}),(0,a.jsx)("div",{className:"dash-topbar-value",children:W})]}),(0,a.jsxs)("div",{className:"dash-topbar-score",children:[(0,a.jsx)("div",{className:"dash-topbar-label",children:"SCORE"}),(0,a.jsx)("div",{className:"dash-topbar-score-value",children:tl.toString()}),q&&(0,a.jsx)("div",{className:"dash-topbar-label",style:{marginTop:6,color:"perfect"===q?"#22d3ee":"#fbbf24"},children:"perfect"===q?"PERFECT":"NEAR"})]}),(0,a.jsxs)("div",{className:"dash-topbar-right",children:[(0,a.jsx)("div",{className:"dash-topbar-label",children:"TOTAL"}),(0,a.jsx)("div",{className:"dash-topbar-value",children:tu.toString()})]})]}),(0,a.jsx)("button",{className:"dash-standings",onClick:()=>R(!0),children:"Standings"}),(0,a.jsx)(w,{active:e2,entrySeedBase:tr,attemptNumber:ta,onDistance:e5,onCrash:e3,onCombo:z,onFeedback:ti},"attempt-".concat(T,"-").concat(L?"over":"run")),!eQ&&(0,a.jsx)("div",{className:"dash-overlay",children:(0,a.jsxs)("div",{className:"dash-overlay-inner",children:[(0,a.jsx)("p",{style:{marginBottom:10,opacity:.9},children:"Join to start dashing."}),(0,a.jsx)("button",{className:"action-btn",onClick:e8,disabled:$,children:$?"Joining...":r?"Join Round (demo)":"Join Round (".concat((0,h.c)(ez)," ETH)")})]})}),eQ&&T>=3&&(0,a.jsx)("div",{className:"dash-overlay",children:(0,a.jsxs)("div",{className:"dash-overlay-inner",children:[(0,a.jsx)("p",{style:{marginBottom:10,opacity:.9},children:"All attempts used for this entry."}),(0,a.jsx)("p",{style:{marginBottom:12,opacity:.75,fontSize:13},children:"Leaderboard keeps your best entry. Start a new entry to retry with a new seed."}),(0,a.jsx)("button",{className:"action-btn",onClick:e9,disabled:$,children:$?"Starting...":r?"Start New Entry (demo)":"Start New Entry (".concat((0,h.c)(ez)," ETH)")})]})}),eQ&&L&&T<3&&(0,a.jsx)("div",{className:"dash-overlay",children:(0,a.jsxs)("div",{className:"dash-overlay-inner",children:[(0,a.jsx)("p",{style:{marginBottom:6,fontWeight:800},children:"Attempt over"}),(0,a.jsxs)("p",{style:{marginBottom:12,opacity:.8,fontSize:13},children:["Attempt score: ",tl.toString()," • Total: ",tu.toString()]}),(0,a.jsx)("button",{className:"action-btn",onClick:async()=>{if(!r&&(null!=P?P:0n)>0n)try{await e6()}catch(e){}if(!r&&null!==i)try{await Z({address:x,abi:b,functionName:"startAttempt",args:[i]}),eE(),eT(),eP()}catch(e){}H(!1),eK.current=0},disabled:O,children:O?"Locking...":"Next Attempt"})]})})]}),eV&&!eW&&(0,a.jsx)("button",{className:"action-btn",onClick:e7,disabled:$,children:$?"Finalizing...":r?"Finalize (demo)":"Finalize Round"}),(eW||eV)&&(0,a.jsx)("button",{className:"action-btn",onClick:e4,disabled:$,children:$?"Creating...":r?"Restart Demo Round":"Create New Round"}),C&&(0,a.jsx)("div",{className:"drawer-backdrop",onClick:()=>R(!1),children:(0,a.jsxs)("div",{className:"drawer",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"drawer-header",children:[(0,a.jsx)("h3",{children:"Standings"}),(0,a.jsx)("button",{className:"drawer-close",onClick:()=>R(!1),children:"Close"})]}),0===l.length?(0,a.jsx)("p",{style:{color:"var(--muted)"},children:"No players yet"}):(0,a.jsx)("ul",{className:"leaderboard",children:l.map((e,n)=>{let r;return(0,a.jsxs)("li",{children:[(0,a.jsxs)("span",{className:"rank",children:["#",n+1]}),(0,a.jsx)("span",{className:"addr",children:e.address.toLowerCase()===t.toLowerCase()?"You":(r=e.address,"".concat(r.slice(0,6),"...").concat(r.slice(-4)))}),(0,a.jsx)("span",{className:"score",children:e.score.toString()})]},e.address)})}),(0,a.jsxs)("div",{className:"status",style:{marginTop:10},children:["Attempt score: ",P.toString()," • Attempts used: ",T,"/",3]}),!r&&(0,a.jsx)("div",{className:"status",style:{marginTop:6},children:"Batched commits every ~3s (or when distance builds up). No per-action tx spam."})]})})]})}function M(){let{address:e,isConnected:t}=(0,r.F)(),{connect:n}=(0,i.e)(),{disconnect:u}=(0,s.u)();return(0,a.jsxs)("div",{className:"container",children:[(0,a.jsxs)("header",{className:"header",children:[(0,a.jsx)("h1",{children:"MegaRally"}),t?(0,a.jsxs)("button",{className:"connect-btn",onClick:()=>u(),children:[null==e?void 0:e.slice(0,6),"...",null==e?void 0:e.slice(-4)]}):(0,a.jsx)("button",{className:"connect-btn",onClick:()=>n({connector:(0,l.b)()}),children:"Connect"})]}),t?(0,a.jsx)(S,{address:e,demo:!1}):(0,a.jsx)("div",{className:"no-round",children:(0,a.jsx)("p",{children:"Connect your wallet to play"})})]})}},9249:(e,t,n)=>{Promise.resolve().then(n.bind(n,639))}},e=>{e.O(0,[496,109,441,255,358],()=>e(e.s=9249)),_N_E=e.O()}]);